<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼˜é›…çš„åä½œç¼–è¾‘é…ç½®æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        .controls {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .config-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
        }
        .btn-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }
        .status {
            margin-top: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        .iframe-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .iframe-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            font-weight: 600;
        }
        iframe {
            width: 100%;
            height: 700px;
            border: none;
            display: block;
        }
        .feature-highlight {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #ff6b6b;
        }
        .feature-highlight h3 {
            margin: 0 0 10px 0;
            color: #d63031;
        }
        .feature-highlight p {
            margin: 0;
            color: #2d3436;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ ä¼˜é›…çš„åä½œç¼–è¾‘é…ç½®</h1>
            <p>é€šè¿‡ externalEnvironment.js å®ç°æ›´ä¼˜é›…çš„é…ç½®ç®¡ç†</p>
        </div>
        
        <div class="feature-highlight">
            <h3>âœ¨ æ–°ç‰¹æ€§</h3>
            <p>ç°åœ¨å¯ä»¥é€šè¿‡ externalEnvironment mixin æ¥ä¼˜é›…åœ°ç®¡ç†åä½œç¼–è¾‘é…ç½®ï¼Œæ”¯æŒåŠ¨æ€é…ç½®æ›´æ–°å’Œäº‹ä»¶é€šçŸ¥ã€‚</p>
        </div>
        
        <div class="controls">
            <h3 style="margin-top: 0; color: #333; font-size: 1.5em;">åä½œç¼–è¾‘é…ç½®</h3>
            
            <div class="config-section">
                <div class="form-group">
                    <label for="roomName">ğŸ  æˆ¿é—´åç§°</label>
                    <input type="text" id="roomName" value="elegant-room" placeholder="è¾“å…¥åä½œæˆ¿é—´åç§°">
                </div>
                <div class="form-group">
                    <label for="wsServer">ğŸŒ WebSocketæœåŠ¡å™¨</label>
                    <input type="text" id="wsServer" value="ws://localhost:4444" placeholder="è¾“å…¥WebSocketæœåŠ¡å™¨åœ°å€">
                </div>
                <div class="form-group">
                    <label for="userName">ğŸ‘¤ ç”¨æˆ·å</label>
                    <input type="text" id="userName" value="ä¼˜é›…ç”¨æˆ·" placeholder="è¾“å…¥ç”¨æˆ·å">
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn btn-primary" onclick="loadMindMap()">ğŸ“± åŠ è½½æ€ç»´å¯¼å›¾</button>
                <button class="btn btn-secondary" onclick="setCooperateConfig()">âš™ï¸ è®¾ç½®åä½œé…ç½®</button>
                <button class="btn btn-success" onclick="getCooperateConfig()">ğŸ“‹ è·å–å½“å‰é…ç½®</button>
                <button class="btn btn-primary" onclick="testDynamicUpdate()">ğŸ”„ æµ‹è¯•åŠ¨æ€æ›´æ–°</button>
            </div>
            
            <div class="status" id="status">
çŠ¶æ€: ç­‰å¾…æ“ä½œ...

ğŸ’¡ ä½¿ç”¨è¯´æ˜:
1. ç‚¹å‡»"åŠ è½½æ€ç»´å¯¼å›¾"åŠ è½½iframe
2. ç‚¹å‡»"è®¾ç½®åä½œé…ç½®"é…ç½®åä½œå‚æ•°
3. é…ç½®ä¼šé€šè¿‡externalEnvironmentä¼˜é›…åœ°ä¼ é€’ç»™ç»„ä»¶
4. æ”¯æŒåŠ¨æ€æ›´æ–°é…ç½®ï¼Œæ— éœ€é‡æ–°åŠ è½½é¡µé¢
            </div>
        </div>
        
        <div class="iframe-container">
            <div class="iframe-header">
                ğŸ“Š æ€ç»´å¯¼å›¾ - åä½œç¼–è¾‘æ¨¡å¼
            </div>
            <iframe id="mindMapFrame" src="about:blank"></iframe>
        </div>
    </div>

    <script>
        let mindMapFrame = null;
        let statusLog = [];
        
        function updateStatus(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            statusLog.push(logEntry);
            
            // ä¿æŒæœ€è¿‘20æ¡æ—¥å¿—
            if (statusLog.length > 20) {
                statusLog = statusLog.slice(-20);
            }
            
            const statusElement = document.getElementById('status');
            statusElement.textContent = statusLog.join('\n');
            statusElement.scrollTop = statusElement.scrollHeight;
            
            console.log(logEntry);
        }
        
        function loadMindMap() {
            mindMapFrame = document.getElementById('mindMapFrame');
            mindMapFrame.src = './index.html?userName=æµ‹è¯•ç”¨æˆ·';
            updateStatus('ğŸ”„ æ­£åœ¨åŠ è½½æ€ç»´å¯¼å›¾...');
            
            mindMapFrame.onload = function() {
                updateStatus('âœ… æ€ç»´å¯¼å›¾åŠ è½½å®Œæˆï¼ç°åœ¨å¯ä»¥è®¾ç½®åä½œé…ç½®äº†');
                
                // ç›‘å¬iframeä¸­çš„äº‹ä»¶
                try {
                    const iframeWindow = mindMapFrame.contentWindow;
                    if (iframeWindow.$bus) {
                        iframeWindow.$bus.$on('cooperate_config_changed', (config) => {
                            updateStatus('ğŸ“¢ åä½œé…ç½®å·²æ›´æ–°: ' + JSON.stringify(config));
                        });
                    }
                } catch (error) {
                    updateStatus('âš ï¸ æ— æ³•ç›‘å¬iframeäº‹ä»¶: ' + error.message);
                }
            };
        }
        
        function setCooperateConfig() {
            if (!mindMapFrame || !mindMapFrame.contentWindow) {
                updateStatus('âŒ è¯·å…ˆåŠ è½½æ€ç»´å¯¼å›¾');
                return;
            }
            
            const roomName = document.getElementById('roomName').value;
            const wsServer = document.getElementById('wsServer').value;
            const userName = document.getElementById('userName').value;
            
            const config = {
                roomName: roomName,
                signalingList: [wsServer],
                userName: userName
            };
            
            try {
                // æ–¹æ³•1: é€šè¿‡å…¨å±€windowå¯¹è±¡è®¾ç½®
                if (mindMapFrame.contentWindow.setCooperateConfig) {
                    mindMapFrame.contentWindow.setCooperateConfig(config);
                    updateStatus('âœ… é€šè¿‡å…¨å±€æ–¹æ³•è®¾ç½®åä½œé…ç½®æˆåŠŸ');
                }
                
                // æ–¹æ³•2: é€šè¿‡externalEnvironmentè®¾ç½®ï¼ˆå¦‚æœç»„ä»¶å·²åŠ è½½ï¼‰
                setTimeout(() => {
                    try {
                        const iframeWindow = mindMapFrame.contentWindow;
                        if (iframeWindow.$bus) {
                            iframeWindow.$bus.$emit('set_cooperate_config', config);
                            updateStatus('ğŸ“¡ é€šè¿‡äº‹ä»¶æ€»çº¿å‘é€é…ç½®æ›´æ–°');
                        }
                    } catch (error) {
                        updateStatus('âš ï¸ äº‹ä»¶æ€»çº¿é€šä¿¡å¤±è´¥: ' + error.message);
                    }
                }, 500);
                
                updateStatus('ğŸ“ é…ç½®è¯¦æƒ…: ' + JSON.stringify(config, null, 2));
                
            } catch (error) {
                updateStatus('âŒ è®¾ç½®åä½œé…ç½®æ—¶å‡ºé”™: ' + error.message);
            }
        }
        
        function getCooperateConfig() {
            if (!mindMapFrame || !mindMapFrame.contentWindow) {
                updateStatus('âŒ è¯·å…ˆåŠ è½½æ€ç»´å¯¼å›¾');
                return;
            }
            
            try {
                // å°è¯•é€šè¿‡å…¨å±€æ–¹æ³•è·å–
                if (mindMapFrame.contentWindow.getCooperateConfig) {
                    const config = mindMapFrame.contentWindow.getCooperateConfig();
                    updateStatus('ğŸ“‹ å½“å‰åä½œé…ç½®: ' + JSON.stringify(config, null, 2));
                } else {
                    updateStatus('âŒ æ— æ³•æ‰¾åˆ°getCooperateConfigæ–¹æ³•');
                }
            } catch (error) {
                updateStatus('âŒ è·å–åä½œé…ç½®æ—¶å‡ºé”™: ' + error.message);
            }
        }
        
        function testDynamicUpdate() {
            if (!mindMapFrame || !mindMapFrame.contentWindow) {
                updateStatus('âŒ è¯·å…ˆåŠ è½½æ€ç»´å¯¼å›¾');
                return;
            }
            
            const configs = [
                {
                    roomName: 'dynamic-room-1',
                    signalingList: ['ws://localhost:4444'],
                    userName: 'åŠ¨æ€ç”¨æˆ·1'
                },
                {
                    roomName: 'dynamic-room-2', 
                    signalingList: ['ws://localhost:4445'],
                    userName: 'åŠ¨æ€ç”¨æˆ·2'
                }
            ];
            
            let index = 0;
            const interval = setInterval(() => {
                if (index >= configs.length) {
                    clearInterval(interval);
                    updateStatus('ğŸ‰ åŠ¨æ€æ›´æ–°æµ‹è¯•å®Œæˆï¼');
                    return;
                }
                
                const config = configs[index];
                try {
                    if (mindMapFrame.contentWindow.setCooperateConfig) {
                        mindMapFrame.contentWindow.setCooperateConfig(config);
                        updateStatus(`ğŸ”„ åŠ¨æ€æ›´æ–° ${index + 1}: ${JSON.stringify(config)}`);
                    }
                } catch (error) {
                    updateStatus(`âŒ åŠ¨æ€æ›´æ–°å¤±è´¥: ${error.message}`);
                }
                
                index++;
            }, 2000);
            
            updateStatus('ğŸš€ å¼€å§‹åŠ¨æ€æ›´æ–°æµ‹è¯•...');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        window.onload = function() {
            updateStatus('ğŸ¯ é¡µé¢åŠ è½½å®Œæˆï¼Œå‡†å¤‡å°±ç»ªï¼');
            updateStatus('ğŸ’¡ æç¤º: è¯·å…ˆç‚¹å‡»"åŠ è½½æ€ç»´å¯¼å›¾"æŒ‰é’®');
        };
    </script>
</body>
</html>